
IF (PKG_CONFIG_FOUND)
    PKG_CHECK_MODULES(ZLIB zlib)
    IF (ZLIB_FOUND)
        INCLUDE_DIRECTORIES(${ZLIB_INCLUDE_DIRS})
        LINK_DIRECTORIES(${ZLIB_LIBRARY_DIRS})
    ELSE (ZLIB_FOUND)
        MESSAGE(STATUS "Did not find zlib pkgconfig..." )
    ENDIF (ZLIB_FOUND)
ELSE (PKG_CONFIG_FOUND)
    FIND_PACKAGE(ZLIB)
    INCLUDE_DIRECTORIES(${ZLIB_INCLUDE_DIR})
    LINK_DIRECTORIES(${ZLIB_LIBRARY_DIR})
ENDIF (PKG_CONFIG_FOUND)

IF (MSVC)
    IF (BUILD_SHARED)
        SET(Z_LIB zlib)
    ELSE (BUILD_SHARED)        
        SET(Z_LIB zlibstatic)
    ENDIF (BUILD_SHARED)
    SET(ZZIP_LIB zzip)
    SET(ZZIP_MAPPED zzipmapped)
    SET(ZZIP_FSEEKO zzipfseeko)
ELSE ()
    SET(Z_LIB -lz)
    SET(ZZIP_LIB -lzzip)
    SET(ZZIP_MAPPED -lzzipmapped)
    SET(ZZIP_FSEEKO -lzzipfseeko)
ENDIF ()

INCLUDE_DIRECTORIES(${CMAKE_SOURCE_DIR})
INCLUDE_DIRECTORIES(${CMAKE_BINARY_DIR})

LINK_DIRECTORIES(${CMAKE_BINARY_DIR}/zzip)

IF (MSVC AND BUILD_SHARED)
    ADD_DEFINITIONS(-DZZIP_EXPORTS)
ENDIF ()
IF(USE_MMAP)
    ADD_DEFINITIONS(-D_USE_MMAP)
ENDIF()
IF(LOWSTK)
    ADD_DEFINITIONS(-D_LOWSTK)
ENDIF()
IF(LARGEFILE_SOURCE)
    ADD_DEFINITIONS(-D_LARGEFILE_SOURCE)
ENDIF()
IF(ZZIP_EASY)
    ADD_DEFINITIONS(-DZZIP_EASY)
ENDIF()
IF(ZZIP_HARDEN)
    ADD_DEFINITIONS(-DZZIP_HARDEN)
ENDIF()
IF(ZZIP_ALLOW_MODULO_ENTRIES)
    ADD_DEFINITIONS(-DZZIP_ALLOW_MODULO_ENTRIES)
ENDIF()

IF(MSVC)
    ADD_DEFINITIONS(-D_CRT_SECURE_NO_WARNINGS)
    SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} /wd4100 /wd4996 /wd4244 /wd4706 /wd4702 /wd4127 /wd4701")
ELSEIF(UNIX)
    SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -fomit-frame-pointer -Wwrite-strings")
    SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Wstrict-prototypes -Wpointer-arith")
    SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Wsign-compare -Wmissing-declarations")
    SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Wstrict-aliasing -Warray-bounds")
ENDIF()
